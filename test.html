<!doctype html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Europin</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">
  <!-- <link rel="stylesheet" href="css/style.css"> -->

  <!--[if lte IE 8]>
  <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
  <![endif]-->
</head>
<body>

  <header>
	<h1>europ.in</h1>
  </header>
  <div class="content">

  </div>
  <footer></footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script>
	$(function(){
		var imgnr = 0
		var searchTerm = "Saldus"
		var api_key = "HTMQFSCKKB"
		var errors = []
		var stopat = 100
		$.getJSON("http://api.europeana.eu/api/opensearch.json?callback=?", {
				searchTerms: searchTerm,
				wskey: api_key,
				qf: "TYPE:IMAGE"
			}, function(data){
				var currentPage = 1
				var pages = Math.ceil(data.totalResults / data.itemsPerPage) - 1
				$.each(data.items, function(i){
					$.getJSON(data.items[i].link+"&callback=?", function(item){
						newimg = new Image()
						newimg.src = "http://social.apps.lv/image.php?w=200&zc=3&src="+encodeURIComponent(item['europeana:object'])
						newimg.onload = function(){
							$(".content").append("<img src='http://social.apps.lv/image.php?w=200&zc=3&src="+encodeURIComponent(item['europeana:object'])+"' />")
						}
					})
				})
				while(pages){
					imgnr++
					if(imgnr === stopat){
						break
					}
					currentPage++
					$.getJSON("http://api.europeana.eu/api/opensearch.json?callback=?", {
						searchTerms: searchTerm,
						wskey: api_key,
						qf: "TYPE:IMAGE",
						startPage: currentPage
					}, function(otherpage){
						$.each(otherpage.items, function(i){
							$.getJSON(otherpage.items[i].link+"&callback=?", function(item){
								newimg = new Image()
								newimg.src = "http://social.apps.lv/image.php?w=200&zc=3&src="+encodeURIComponent(item['europeana:object'])
								newimg.onload = function(){
									$(".content").append("<img src='http://social.apps.lv/image.php?w=200&zc=3&src="+encodeURIComponent(item['europeana:object'])+"' />")
								}
							})
						})
					})
					pages--
				}

			}
		)
		console.log(errors)
		$(".content").on("error", "img", function(){
			console.log("error: "+$(this).attr("src"))
		})
	})
  </script>
</body>
</html>